<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ‚Ä¢ Trade Consolidator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
    <div class="layout">
        <aside id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-brand">
                    <span class="brand-logo" title="Trade Consolidator">
                        <svg class="logo-svg" viewBox="0 0 24 24" aria-hidden="true">
                            <rect x="3" y="12" width="4" height="9" rx="1"></rect>
                            <rect x="10" y="7" width="4" height="14" rx="1"></rect>
                            <rect x="17" y="3" width="4" height="18" rx="1"></rect>
                        </svg>
                    </span>
                    <span class="brand-name">Trade Consolidator</span>
                </div>
                <button id="sidebarToggle" class="sidebar-toggle">‚â™</button>
            </div>
            <div class="sidebar-actions">
                <button class="btn btn-upload" onclick="openUploadModal()">+ Upload CSV</button>
            </div>
            <ul class="nav-list">
                <li class="nav-item"><a class="nav-link" href="dashboard.html"><span class="nav-icon">üìä</span><span class="nav-text">Dashboard</span></a></li>
                <li class="nav-item"><a class="nav-link" href="trades.html"><span class="nav-icon">üìã</span><span class="nav-text">Trades</span></a></li>
                <li class="nav-item"><a class="nav-link" href="strategies.html"><span class="nav-icon">üß†</span><span class="nav-text">Estrat√©gias</span></a></li>
                <li class="nav-item"><a class="nav-link" href="diario.html"><span class="nav-icon">üìì</span><span class="nav-text">Di√°rio</span></a></li>
                <li class="nav-item"><a class="nav-link" href="reportes.html"><span class="nav-icon">üìà</span><span class="nav-text">Reportes</span></a></li>
                <li class="nav-item"><a class="nav-link" href="playbook.html"><span class="nav-icon">üìò</span><span class="nav-text">Playbook</span></a></li>
            </ul>
        </aside>
        <main class="main">
        <div class="app-container">
            <div class="app-header">
                <h1 style="margin:0;">Dashboard</h1>
                <div class="filter-inline">
                    <div class="filter-item">
                        <label>Conta</label>
                        <select id="accountFilter" onchange="filterTrades()">
                            <option value="">Todas as contas</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label>Estrat√©gia</label>
                        <select id="strategyFilter" onchange="filterTrades()">
                            <option value="">Todas as estrat√©gias</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label>Instrumento</label>
                        <select id="instrumentFilter" onchange="filterTrades()">
                            <option value="">Todos</option>
                        </select>
                    </div>
                    <div class="filter-item dropdown">
                        <button class="btn btn-secondary small" onclick="toggleDatePanel(event)">Data</button>
                        <div id="datePanel" class="dropdown-panel">
                            <div class="preset-buttons">
                                <button class="btn" onclick="setPreset('this_week')">Essa semana</button>
                                <button class="btn" onclick="setPreset('last_week')">Semana passada</button>
                                <button class="btn" onclick="setPreset('this_month')">Esse m√™s</button>
                                <button class="btn" onclick="setPreset('last_month')">M√™s passado</button>
                                <button class="btn" onclick="setPreset('this_year')">Esse ano</button>
                                <button class="btn" onclick="setPreset('last_year')">Ano passado</button>
                            </div>
                            <input type="text" id="dateRangeInput" class="flatpickr-input" placeholder="Intervalo personalizado">
                            <input type="hidden" id="datePreset">
                            <input type="hidden" id="dateFrom">
                            <input type="hidden" id="dateTo">
                        </div>
                    </div>
                    <div class="filter-item">
                        <button class="btn btn-secondary small" onclick="clearFilters()">Limpar</button>
                    </div>
                </div>
            </div>
        <div class="stats-grid" id="statsGrid"></div>
        <div class="stats-table-grid" id="statisticsTable"></div>
        <div id="chartsSection" class="charts-grid">
            <div class="chart-card"><strong>PnL Di√°rio Acumulado</strong><canvas id="chartDailyCumulative" class="chart-canvas"></canvas></div>
            <div class="chart-card"><strong>PnL por Instrumento</strong><canvas id="chartPnlInstrument" class="chart-canvas"></canvas></div>
            <div class="chart-card"><strong>Win Rate Acumulado</strong><canvas id="chartWinRateCumulative" class="chart-canvas"></canvas></div>
            <div class="chart-card"><strong>PnL Di√°rio</strong><canvas id="chartDailyBar" class="chart-canvas"></canvas></div>
        </div>
        <div class="weekly-grid">
            <div class="weekly-card">
                <div class="card-head"><strong>Distribui√ß√£o de Trades por Dia da Semana</strong><span class="range" id="weekRange1"></span></div>
                <canvas id="chartTradesByWeekday" class="weekly-canvas"></canvas>
            </div>
            <div class="weekly-card">
                <div class="card-head"><strong>Performance por Dia da Semana</strong><span class="range" id="weekRange2"></span></div>
                <canvas id="chartPnlByWeekday" class="weekly-canvas"></canvas>
            </div>
        </div>
        <div class="week-summary" id="weekSummaryTable"></div>
        <div class="weekly-grid" style="margin-top:24px;">
            <div class="weekly-card">
                <div class="card-head"><strong>Distribui√ß√£o de Trades por Estrat√©gia</strong><span class="range" id="strategyRange1"></span></div>
                <canvas id="chartTradesByStrategy" class="weekly-canvas"></canvas>
            </div>
            <div class="weekly-card">
                <div class="card-head"><strong>Desempenho por Estrat√©gia</strong><span class="range" id="strategyRange2"></span></div>
                <canvas id="chartPnlByStrategy" class="weekly-canvas"></canvas>
            </div>
        </div>
        <div class="week-summary" id="strategySummaryTable"></div>
        <div class="calendar-section">
            <div class="calendar-header">
                <div class="title">Calend√°rio de Trades <span id="calendarMonthLabel"></span></div>
                <div class="nav">
                    <button class="btn" onclick="prevCalendarMonth()">‚óÄÔ∏è M√™s anterior</button>
                    <button class="btn" onclick="nextCalendarMonth()">Pr√≥ximo m√™s ‚ñ∂Ô∏è</button>
                </div>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>
        </div>
        </main>
    </div>
    <div id="modalBackdrop" class="modal-backdrop"></div>
    <div id="uploadModal" class="modal">
        <div class="modal-card">
            <div class="modal-header"><strong>üì§ Importar CSV</strong><button class="close-btn" onclick="closeUploadModal()">‚úï</button></div>
            <div>
                <input type="file" id="csvFileModal" accept=".csv" style="display:none" onchange="handleFileUpload(event)">
                <button class="btn btn-primary" onclick="document.getElementById('csvFileModal').click()">Selecionar arquivo CSV</button>
                <div id="uploadMessage" style="margin-top:8px;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeUploadModal()">Fechar</button>
            </div>
        </div>
    </div>
    <script>
    (function(){
        var btn = document.getElementById('sidebarToggle');
        var sb = document.getElementById('sidebar');
        if (btn && sb) { btn.addEventListener('click', function(){ sb.classList.toggle('collapsed'); document.body.classList.toggle('sidebar-collapsed'); }); }
    })();
    function openUploadModal(){ var m = document.getElementById('uploadModal'); var b = document.getElementById('modalBackdrop'); if (m && b) { m.classList.add('open'); b.classList.add('open'); } }
    function closeUploadModal(){ var m = document.getElementById('uploadModal'); var b = document.getElementById('modalBackdrop'); if (m && b) { m.classList.remove('open'); b.classList.remove('open'); } }
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
    (function(){
        var fp = flatpickr('#dateRangeInput', { mode: 'range', dateFormat: 'Y-m-d', onChange: function(sel){ if (!sel || sel.length < 2) return; var f = sel[0]; var t = sel[1]; var df = document.getElementById('dateFrom'); var dt = document.getElementById('dateTo'); var dp = document.getElementById('datePreset'); if (df && dt && dp) { dp.value = ''; df.value = fp.formatDate(f, 'Y-m-d'); dt.value = fp.formatDate(t, 'Y-m-d'); filterTrades(); } } });
        document.addEventListener('click', function(e){ var p = document.getElementById('datePanel'); if (!p) return; if (!p.contains(e.target) && !(e.target && e.target.closest('.dropdown'))) { p.classList.remove('open'); } });
    })();
    function toggleDatePanel(ev){ ev && ev.stopPropagation(); var p = document.getElementById('datePanel'); if (p) { p.classList.toggle('open'); } }
    function setPreset(p){ var dp = document.getElementById('datePreset'); var df = document.getElementById('dateFrom'); var dt = document.getElementById('dateTo'); if (dp && df && dt) { dp.value = p; df.value = ''; dt.value = ''; filterTrades(); } }
    function clearFilters(){ try { var af=document.getElementById('accountFilter'); var sf=document.getElementById('strategyFilter'); var inf=document.getElementById('instrumentFilter'); var dp=document.getElementById('datePreset'); var df=document.getElementById('dateFrom'); var dt=document.getElementById('dateTo'); var dri=document.getElementById('dateRangeInput'); if(af) af.value=''; if(sf) sf.value=''; if(inf) inf.value=''; if(dp) dp.value=''; if(df) df.value=''; if(dt) dt.value=''; if(dri) dri.value=''; } catch(e){} filterTrades(); }
    </script>
    <script src="globals.js"></script>
    <script src="supabase-init.js"></script>
    <script src="theme.js"></script>
    <script src="strategies.js"></script>
    <script src="trades.js"></script>
    <script src="dashboard-charts.js"></script>
    <script src="table.js"></script>
    <script src="main.js"></script>
</body>
</html>
